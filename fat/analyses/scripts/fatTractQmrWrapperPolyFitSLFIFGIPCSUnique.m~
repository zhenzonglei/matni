
clear all;

% The following parameters need to be adjusted to fit your system
fatDir=fullfile('/sni-storage/kalanit/biac2/kgs/projects/NFA_tasks/data_mrAuto');
anatDir_system =fullfile('/biac2/kgs/3Danat');
anatDir =('/sni-storage/kalanit/biac2/kgs/3Danat');

dtiSessid={'01_sc_dti_080917' '02_at_dti_080517' '03_as_dti_083016'...
    '04_kg_dti_101014' '05_mg_dti_071217' '06_jg_dti_083016'...
    '07_bj_qMRI_081117' '08_sg_dti_081417' '10_em_dti_080817'...
    '12_rc_dti_080717' '13_cb_dti_081317' '16_kw_dti_082117'...
    '18_nc_dti_090817'}

qmrSessid={'01_sc_qMRI_080917' '02_at_qMRI_080517' '03_as_qMRI_083016'...
    '04_kg_qMRI_101014' '05_mg_qMRI_071217' '06_jg_qMRI_083016'...
    '07_bj_qMRI_081117' '08_sg_qMRI_081417' '10_em_qMRI_080817'...
    '12_rc_qMRI_080717' '13_cb_qMRI_081317' '16_kw_qMRI_082117'...
    '18_nc_qMRI_090817'}

%anatid={'jesse_new_recon_2017'}
runName={'96dir_run1'}

fgName={'lh_IFG_union_morphing_reading_vs_all_r5.00_run1_lmax8_curvatures_concatenated_optimize_it500_new_classified_unique.mat'...
    'lh_IPCS_morphing_adding_vs_all_r5.00_run1_lmax8_curvatures_concatenated_optimize_it500_new_classified_unique.mat'}

counter=1;
for s=1:length(dtiSessid)
    if (exist(fullfile(fatDir,dtiSessid{s},'96dir_run1/dti96trilin/fibers/afq',fgName{1})) && exist(fullfile(fatDir,dtiSessid{s},'96dir_run1/dti96trilin/fibers/afq',fgName{2})))>0
        
        for i=1:length(fgName)
            [T1, TV]=fatTractQmrMg(fatDir, dtiSessid{s}, runName{1}, fgName{i}, fatDir, qmrSessid{s})
            t1(counter,:,i)=T1(:,1);
            tv(counter,:,i)=TV(:,1);
            x=[1:30];
            pol(counter,:,i)=polyfit(x,t1(counter,:,i),1)
            polyn(counter,:,i)=polyval(pol(counter,:,i),x)
            
            
            figure
            d=plot(x,t1(counter,:,i),'o')
            hold on
            h=plot(x,polyn(counter,:,i))
            ylim([0.85 1.1]);
            if i==1
            set(h,'Color','g')
            set(d,'Color','g')
            end
        end
        counter=counter+1;
        
    else
    end
    
end

polyNew=polyn
polyMin=squeeze(min(polyNew,[],2))
polyMean=squeeze(mean(polyNew,1))
polyStd=squeeze(std(polyNew))
polySe=polyStd/sqrt(11);

polNew=pol
polMin=squeeze(min(polyNew,[],2))
polMean=squeeze(mean(polyNew,1))
polStd=squeeze(std(polyNew))
polSe=polyStd/sqrt(11);

%  t1new=t1
% 
% t1mean=mean(t1new,1);
% t1means=squeeze(t1mean);   
% 
% t1std=std(t1new);
% t1std=squeeze(t1std);
% t1ste=t1std/(sqrt(counter-2));
% 
p1=errorbar(polyMean(:,2),polySe(:,2),'Color','g')
hold on
p2=errorbar(polyMean(:,1),polySe(:,1),'Color','b')
legend([p1;p2],'Math','Reading')
ylim([0.85 1.1]);
xlim([1 30]);
t=title('SLF','FontSize',18,'FontName','Arial','FontWeight','bold');
% P = get(t,'Position');
% set(t,'Position',[P(1) P(2) P(3)])
ylabel('t1','FontSize',16,'FontName','Arial','FontWeight','bold');
xlabel('Section','FontSize',16,'FontName','Arial','FontWeight','bold');
pbaspect([1 1 1])
set(gca,'FontSize',16,'FontWeight','bold'); box off; set(gca,'Linewidth',2);      
hold off
